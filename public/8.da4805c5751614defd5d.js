(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"1G5W":function(e,t,i){"use strict";i.d(t,"a",function(){return n});var a=i("zx2A");function n(e){return t=>t.lift(new s(e))}class s{constructor(e){this.notifier=e}call(e,t){const i=new r(e),n=Object(a.c)(this.notifier,new a.a(i));return n&&!i.seenValue?(i.add(n),t.subscribe(i)):i}}class r extends a.b{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}},V1Zt:function(e,t,i){"use strict";i.r(t),i.d(t,"ArcadeModule",function(){return te});var a=i("ofXK"),n=i("tyNb"),s=i("mrSG"),r=i("qzk7"),o=i("fXoL"),h=i("XNiG"),c=i("2Vo4"),d=i("LRne"),l=i("HDdC"),u=i("DH7j"),p=i("n6bG"),y=i("lJxs");function b(e,t,i){return i?b(e,t).pipe(Object(y.a)(e=>Object(u.a)(e)?i(...e):i(e))):new l.a(i=>{const a=(...e)=>i.next(1===e.length?e[0]:e);let n;try{n=e(a)}catch(s){return void i.error(s)}if(Object(p.a)(t))return()=>t(a,n)})}var g=i("itXk"),_=i("mCNh"),f=i("VRyK"),m=i("IzEk"),v=i("JX91"),w=i("vkgz"),k=i("1G5W"),S=i("oB13"),P=i("eIep"),C=i("5+tZ"),j=i("l7GE"),O=i("ZUHj");function V(...e){return t=>{let i;return"function"==typeof e[e.length-1]&&(i=e.pop()),t.lift(new I(e,i))}}class I{constructor(e,t){this.observables=e,this.project=t}call(e,t){return t.subscribe(new R(e,this.observables,this.project))}}class R extends j.a{constructor(e,t,i){super(e),this.observables=t,this.project=i,this.toRespond=[];const a=t.length;this.values=new Array(a);for(let n=0;n<a;n++)this.toRespond.push(n);for(let n=0;n<a;n++){let e=t[n];this.add(Object(O.a)(this,e,void 0,n))}}notifyNext(e,t,i){this.values[i]=t;const a=this.toRespond;if(a.length>0){const e=a.indexOf(i);-1!==e&&a.splice(e,1)}}notifyComplete(){}_next(e){if(0===this.toRespond.length){const t=[e,...this.values];this.project?this._tryProject(t):this.destination.next(t)}}_tryProject(e){let t;try{t=this.project.apply(this,e)}catch(i){return void this.destination.error(i)}this.destination.next(t)}}var M=i("Kqap"),x=i("/uUt"),L=i("Cfvw"),D=i("7o/Q");class z{constructor(e){this.predicate=e}call(e,t){return t.subscribe(new T(e,this.predicate))}}class T extends D.a{constructor(e,t){super(e),this.predicate=t,this.skipping=!0,this.index=0}_next(e){const t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)}tryCallPredicate(e){try{const t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(t){this.destination.error(t)}}}var E=i("pLZG");const G=["youtubeContainer"];let A=(()=>{class e{constructor(e,t){this._ngZone=e,this._youtubeContainer=new h.a,this._destroyed=new h.a,this._playerChanges=new c.a(void 0),this._videoId=new c.a(void 0),this._height=new c.a(390),this._width=new c.a(640),this._startSeconds=new c.a(void 0),this._endSeconds=new c.a(void 0),this._suggestedQuality=new c.a(void 0),this._playerVars=new c.a(void 0),this.ready=this._getLazyEmitter("onReady"),this.stateChange=this._getLazyEmitter("onStateChange"),this.error=this._getLazyEmitter("onError"),this.apiChange=this._getLazyEmitter("onApiChange"),this.playbackQualityChange=this._getLazyEmitter("onPlaybackQualityChange"),this.playbackRateChange=this._getLazyEmitter("onPlaybackRateChange"),this._isBrowser=Object(a.p)(t)}get videoId(){return this._videoId.value}set videoId(e){this._videoId.next(e)}get height(){return this._height.value}set height(e){this._height.next(e||390)}get width(){return this._width.value}set width(e){this._width.next(e||640)}set startSeconds(e){this._startSeconds.next(e)}set endSeconds(e){this._endSeconds.next(e)}set suggestedQuality(e){this._suggestedQuality.next(e)}get playerVars(){return this._playerVars.value}set playerVars(e){this._playerVars.next(e)}ngOnInit(){if(!this._isBrowser)return;let e=Object(d.a)(!0);if(!window.YT||!window.YT.Player){const t=new h.a;this._existingApiReadyCallback=window.onYouTubeIframeAPIReady,window.onYouTubeIframeAPIReady=()=>{this._existingApiReadyCallback&&this._existingApiReadyCallback(),this._ngZone.run(()=>t.next(!0))},e=t.pipe(Object(m.a)(1),Object(v.a)(!1))}const t=function(e,t,i,a,n,s,r){const o=Object(g.b)([t,s]).pipe(V(Object(g.b)([a,n])),Object(y.a)(([e,t])=>{const[i,a]=e,[n,s]=t;return i?{videoId:i,playerVars:a,width:n,height:s}:void 0}));return Object(g.b)([e,o,Object(d.a)(r)]).pipe((h=i,Object(_.a)(function(...e){let t=null;return"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Object(u.a)(e[0])&&(e=e[0].slice()),i=>i.lift.call(Object(L.a)([i,...e]),new g.a(t))}(h),(c=([e,t])=>!t,e=>e.lift(new z(c))),Object(y.a)(([e])=>e))),Object(M.a)(Q,void 0),Object(x.a)());var h,c}(this._youtubeContainer,this._videoId,e,this._width,this._height,this._playerVars,this._ngZone).pipe(Object(w.a)(e=>{this._playerChanges.next(e)}),(i=e=>{F(e)||e.destroy()},Object(C.a)(e=>e?F(e)?Object(d.a)(e):new l.a(t=>{let a=!1,n=!1;const s=e=>{n=!0,a||(e.target.removeEventListener("onReady",s),t.next(e.target))};return e.addEventListener("onReady",s),()=>{a=!0,n||i(e)}}).pipe(Object(m.a)(1),Object(v.a)(void 0)):Object(d.a)(void 0))),Object(k.a)(this._destroyed),Object(S.a)(new h.a));var i;t.subscribe(e=>{this._player=e,e&&this._pendingPlayerState&&this._initializePlayer(e,this._pendingPlayerState),this._pendingPlayerState=void 0}),function(e,t,i){Object(g.b)([e,t,i]).subscribe(([e,t,i])=>e&&e.setSize(t,i))}(t,this._width,this._height),function(e,t){Object(g.b)([e,t]).subscribe(([e,t])=>e&&t&&e.setPlaybackQuality(t))}(t,this._suggestedQuality),function(e,t,i,a,n,s){const r=Object(g.b)([i,a]).pipe(Object(y.a)(([e,t])=>({startSeconds:e,endSeconds:t}))),o=r.pipe(H(e,e=>!!e&&!function(e){const t=e.getPlayerState();return-1!==t&&5!==t}(e))),h=t.pipe(H(e,(e,t)=>!!e&&e.videoId!==t)),c=e.pipe(H(Object(g.b)([t,r]),([e,t],i)=>!(!i||e==i.videoId&&!t.startSeconds&&!t.endSeconds)));Object(f.a)(c,h,o).pipe(V(Object(g.b)([e,t,r,n])),Object(y.a)(([e,t])=>t),Object(k.a)(s)).subscribe(([e,t,i,a])=>{t&&e&&(e.videoId=t,e.cueVideoById(Object.assign({videoId:t,suggestedQuality:a},i)))})}(t,this._videoId,this._startSeconds,this._endSeconds,this._suggestedQuality,this._destroyed),t.connect()}createEventsBoundInZone(){return{}}ngAfterViewInit(){this._youtubeContainer.next(this.youtubeContainer.nativeElement)}ngOnDestroy(){this._player&&(this._player.destroy(),window.onYouTubeIframeAPIReady=this._existingApiReadyCallback),this._playerChanges.complete(),this._videoId.complete(),this._height.complete(),this._width.complete(),this._startSeconds.complete(),this._endSeconds.complete(),this._suggestedQuality.complete(),this._youtubeContainer.complete(),this._playerVars.complete(),this._destroyed.next(),this._destroyed.complete()}playVideo(){this._player?this._player.playVideo():this._getPendingState().playbackState=1}pauseVideo(){this._player?this._player.pauseVideo():this._getPendingState().playbackState=2}stopVideo(){this._player?this._player.stopVideo():this._getPendingState().playbackState=5}seekTo(e,t){this._player?this._player.seekTo(e,t):this._getPendingState().seek={seconds:e,allowSeekAhead:t}}mute(){this._player?this._player.mute():this._getPendingState().muted=!0}unMute(){this._player?this._player.unMute():this._getPendingState().muted=!1}isMuted(){return this._player?this._player.isMuted():!!this._pendingPlayerState&&!!this._pendingPlayerState.muted}setVolume(e){this._player?this._player.setVolume(e):this._getPendingState().volume=e}getVolume(){return this._player?this._player.getVolume():this._pendingPlayerState&&null!=this._pendingPlayerState.volume?this._pendingPlayerState.volume:0}setPlaybackRate(e){if(this._player)return this._player.setPlaybackRate(e);this._getPendingState().playbackRate=e}getPlaybackRate(){return this._player?this._player.getPlaybackRate():this._pendingPlayerState&&null!=this._pendingPlayerState.playbackRate?this._pendingPlayerState.playbackRate:0}getAvailablePlaybackRates(){return this._player?this._player.getAvailablePlaybackRates():[]}getVideoLoadedFraction(){return this._player?this._player.getVideoLoadedFraction():0}getPlayerState(){if(this._isBrowser&&window.YT)return this._player?this._player.getPlayerState():this._pendingPlayerState&&null!=this._pendingPlayerState.playbackState?this._pendingPlayerState.playbackState:-1}getCurrentTime(){return this._player?this._player.getCurrentTime():this._pendingPlayerState&&this._pendingPlayerState.seek?this._pendingPlayerState.seek.seconds:0}getPlaybackQuality(){return this._player?this._player.getPlaybackQuality():"default"}getAvailableQualityLevels(){return this._player?this._player.getAvailableQualityLevels():[]}getDuration(){return this._player?this._player.getDuration():0}getVideoUrl(){return this._player?this._player.getVideoUrl():""}getVideoEmbedCode(){return this._player?this._player.getVideoEmbedCode():""}_getPendingState(){return this._pendingPlayerState||(this._pendingPlayerState={}),this._pendingPlayerState}_initializePlayer(e,t){const{playbackState:i,playbackRate:a,volume:n,muted:s,seek:r}=t;switch(i){case 1:e.playVideo();break;case 2:e.pauseVideo();break;case 5:e.stopVideo()}null!=a&&e.setPlaybackRate(a),null!=n&&e.setVolume(n),null!=s&&(s?e.mute():e.unMute()),null!=r&&e.seekTo(r.seconds,r.allowSeekAhead)}_getLazyEmitter(e){return this._playerChanges.pipe(Object(P.a)(t=>t?b(i=>{t.addEventListener(e,i)},i=>{try{t.removeEventListener&&t.removeEventListener(e,i)}catch(a){}}):Object(d.a)()),e=>new l.a(t=>e.subscribe({next:e=>this._ngZone.run(()=>t.next(e)),error:e=>t.error(e),complete:()=>t.complete()})),Object(k.a)(this._destroyed))}}return e.\u0275fac=function(t){return new(t||e)(o.Jb(o.z),o.Jb(o.B))},e.\u0275cmp=o.Db({type:e,selectors:[["youtube-player"]],viewQuery:function(e,t){if(1&e&&o.oc(G,!0),2&e){let e;o.cc(e=o.Ub())&&(t.youtubeContainer=e.first)}},inputs:{videoId:"videoId",height:"height",width:"width",startSeconds:"startSeconds",endSeconds:"endSeconds",suggestedQuality:"suggestedQuality",playerVars:"playerVars",showBeforeIframeApiLoads:"showBeforeIframeApiLoads"},outputs:{ready:"ready",stateChange:"stateChange",error:"error",apiChange:"apiChange",playbackQualityChange:"playbackQualityChange",playbackRateChange:"playbackRateChange"},decls:2,vars:0,consts:[["youtubeContainer",""]],template:function(e,t){1&e&&o.Kb(0,"div",null,0)},encapsulation:2,changeDetection:0}),e})();function Q(e,[t,i,a]){if(e&&i&&e.playerVars!==i.playerVars)e.destroy();else{if(!i)return void(e&&e.destroy());if(e)return e}const n=a.runOutsideAngular(()=>new YT.Player(t,i));return n.videoId=i.videoId,n.playerVars=i.playerVars,n}function F(e){return"getPlayerStatus"in e}function H(e,t){return Object(_.a)(V(e),Object(E.a)(([e,i])=>t(i,e)),Object(y.a)(([e])=>e))}let U=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)}}),e})();var B=i("Xa2L");const Z=["video"],N=["canvas"],Y=["youtube"];function J(e,t){1&e&&o.Kb(0,"mat-spinner",11)}function X(e,t){1&e&&(o.Mb(0,"h1"),o.lc(1,"Hai perso, hai sorriso!"),o.Lb())}function K(e,t){1&e&&(o.Mb(0,"h1"),o.lc(1,"Hai vinto, non hai sorriso!"),o.Lb())}function W(e,t){1&e&&(o.Mb(0,"h1"),o.lc(1,"Non riesco a vedere la tua faccia!"),o.Lb())}let q=!1;const $=[{path:"",component:(()=>{class e{constructor(e){this.cdr=e,this.faceMissingDetection=0,this.faceDetected=!1,this.faceHappy=!1,this.loseMatch=!1,this.winMatch=!1,this.happy=0,this.readyToGame=!1,this.width=100,this.height=100,this.playerVars={autoplay:0,controls:0,showinfo:0,modestbranding:1,rel:0},this.loading=!0,this.firstDetectionHappen=!1}ngOnInit(){if(!q){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e),q=!0}}ngOnDestroy(){this.stream&&this.stream.getTracks().forEach(e=>e.stop())}ngAfterViewInit(){}onStateChange(e){0===e.data&&this.winGame()}onReady(e){this.run()}run(){return Object(s.a)(this,void 0,void 0,function*(){this.loading=!0,this.cdr.detectChanges(),this.stream=yield navigator.mediaDevices.getUserMedia({video:{}}),this.video.nativeElement.srcObject=this.stream;const e="/assets/weights/";yield Promise.all([r.e.tinyFaceDetector.loadFromUri(e),r.e.faceRecognitionNet.loadFromUri(e),r.e.faceExpressionNet.loadFromUri(e)]),this.loading=!1,this.cdr.detectChanges()})}onPlay(){return Object(s.a)(this,void 0,void 0,function*(){const e=this.video.nativeElement;if(this.onResize(),this.manageDetectionState(),e.paused||e.ended||!r.e.tinyFaceDetector.params)return this.faceMissingDetection=50,void setTimeout(()=>this.onPlay(),100);const t=yield r.b(e,new r.a).withFaceExpressions();if(t){this.firstDetectionHappen=!0,this.faceMissingDetection=0;const e=t.expressions.happy;if(this.happy!==e&&(this.happy=e,this.cdr.markForCheck()),this.happy>.8)return void this.loseGame()}else this.happy=0,this.firstDetectionHappen&&this.faceMissingDetection++;setTimeout(()=>this.onPlay(),100)})}manageDetectionState(){let e=this.faceMissingDetection<50;this.firstDetectionHappen||(e=!1),this.faceDetected!==e&&(this.faceDetected=e,this.faceDetected?this.youtube.playVideo():this.youtube.pauseVideo(),this.manageReadyToGameState(),this.cdr.markForCheck())}loseGame(){this.loseMatch||(this.winMatch=!1,this.loseMatch=!0,this.video.nativeElement.pause(),this.youtube.pauseVideo(),this.manageReadyToGameState(),this.cdr.markForCheck())}winGame(){this.winMatch||(this.winMatch=!0,this.loseMatch=!1,this.video.nativeElement.pause(),this.youtube.stopVideo(),this.manageReadyToGameState(),this.cdr.markForCheck())}manageReadyToGameState(){const e=!this.loseMatch&&this.faceDetected;this.readyToGame!==e&&(this.readyToGame=e,this.cdr.markForCheck())}onResize(){const e=window.innerWidth,t=window.innerHeight;e===this.width&&t===this.height||(this.width=e,this.height=t,this.cdr.markForCheck())}}return e.\u0275fac=function(t){return new(t||e)(o.Jb(o.h))},e.\u0275cmp=o.Db({type:e,selectors:[["app-arcade"]],viewQuery:function(e,t){if(1&e&&(o.oc(Z,!0),o.oc(N,!0),o.oc(Y,!0)),2&e){let e;o.cc(e=o.Ub())&&(t.video=e.first),o.cc(e=o.Ub())&&(t.canvas=e.first),o.cc(e=o.Ub())&&(t.youtube=e.first)}},hostBindings:function(e,t){1&e&&o.Tb("resize",function(){return t.onResize()},!1,o.ec)},decls:15,vars:15,consts:[["class","spinner",4,"ngIf"],[1,"game-container",3,"hidden"],[1,"info"],[4,"ngIf"],[2,"width","100%"],[1,"youtube",3,"hidden"],["videoId","FFLTU9eIijw",3,"width","height","playerVars","ready","stateChange"],["youtube",""],[1,"webcam",3,"hidden"],["autoplay","","muted","","playsinline","",3,"width","height","loadedmetadata"],["video",""],[1,"spinner"]],template:function(e,t){1&e&&(o.kc(0,J,1,0,"mat-spinner",0),o.Mb(1,"div",1),o.Mb(2,"div",2),o.kc(3,X,2,0,"h1",3),o.kc(4,K,2,0,"h1",3),o.kc(5,W,2,0,"h1",3),o.Mb(6,"div",4),o.lc(7),o.Xb(8,"number"),o.Lb(),o.Lb(),o.Mb(9,"div",5),o.Mb(10,"youtube-player",6,7),o.Tb("ready",function(e){return t.onReady(e)})("stateChange",function(e){return t.onStateChange(e)}),o.Lb(),o.Lb(),o.Mb(12,"div",8),o.Mb(13,"video",9,10),o.Tb("loadedmetadata",function(){return t.onPlay()}),o.Lb(),o.Lb(),o.Lb()),2&e&&(o.bc("ngIf",t.loading),o.zb(1),o.bc("hidden",t.loading),o.zb(2),o.bc("ngIf",t.loseMatch),o.zb(1),o.bc("ngIf",t.winMatch),o.zb(1),o.bc("ngIf",!t.faceDetected&&!t.loseMatch&&!t.winMatch),o.zb(2),o.nc("Felicit\xe0: ",o.Yb(8,13,100*t.happy),"%"),o.zb(2),o.bc("hidden",!t.readyToGame),o.zb(1),o.bc("width",t.width)("height",t.height)("playerVars",t.playerVars),o.zb(2),o.bc("hidden",t.readyToGame),o.zb(1),o.bc("width",t.width)("height",t.height))},directives:[a.j,A,B.c],pipes:[a.d],styles:["[_nghost-%COMP%]{width:100%;height:100%;overflow:hidden}.spinner[_ngcontent-%COMP%]{position:absolute;top:45%;left:45%}.game-container[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#000;overflow:hidden}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#fff;position:absolute;bottom:10px;text-align:center}"]}),e})()}];let ee=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)},imports:[[n.b.forChild($)],n.b]}),e})(),te=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)},imports:[[a.b,ee,B.b,U]]}),e})()}}]);