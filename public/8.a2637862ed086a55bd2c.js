(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{V1Zt:function(e,t,i){"use strict";i.r(t),i.d(t,"ArcadeModule",function(){return ie});var a=i("ofXK"),s=i("tyNb"),n=i("mrSG"),r=i("qzk7"),o=i("fXoL"),c=i("XNiG"),h=i("2Vo4"),d=i("LRne"),l=i("HDdC"),p=i("DH7j"),y=i("n6bG"),u=i("lJxs");function b(e,t,i){return i?b(e,t).pipe(Object(u.a)(e=>Object(p.a)(e)?i(...e):i(e))):new l.a(i=>{const a=(...e)=>i.next(1===e.length?e[0]:e);let s;try{s=e(a)}catch(n){return void i.error(n)}if(Object(y.a)(t))return()=>t(a,s)})}var g=i("itXk"),_=i("mCNh"),m=i("VRyK"),v=i("IzEk"),f=i("JX91"),w=i("vkgz"),k=i("1G5W"),S=i("oB13"),P=i("eIep"),C=i("5+tZ"),j=i("l7GE"),O=i("ZUHj");function V(...e){return t=>{let i;return"function"==typeof e[e.length-1]&&(i=e.pop()),t.lift(new I(e,i))}}class I{constructor(e,t){this.observables=e,this.project=t}call(e,t){return t.subscribe(new M(e,this.observables,this.project))}}class M extends j.a{constructor(e,t,i){super(e),this.observables=t,this.project=i,this.toRespond=[];const a=t.length;this.values=new Array(a);for(let s=0;s<a;s++)this.toRespond.push(s);for(let s=0;s<a;s++){let e=t[s];this.add(Object(O.a)(this,e,void 0,s))}}notifyNext(e,t,i){this.values[i]=t;const a=this.toRespond;if(a.length>0){const e=a.indexOf(i);-1!==e&&a.splice(e,1)}}notifyComplete(){}_next(e){if(0===this.toRespond.length){const t=[e,...this.values];this.project?this._tryProject(t):this.destination.next(t)}}_tryProject(e){let t;try{t=this.project.apply(this,e)}catch(i){return void this.destination.error(i)}this.destination.next(t)}}var R=i("Kqap"),x=i("7o/Q");class L{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new D(e,this.compare,this.keySelector))}}class D extends x.a{constructor(e,t,i){super(e),this.keySelector=i,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t;try{const{keySelector:i}=this;t=i?i(e):e}catch(a){return this.destination.error(a)}let i=!1;if(this.hasKey)try{const{compare:e}=this;i=e(this.key,t)}catch(a){return this.destination.error(a)}else this.hasKey=!0;i||(this.key=t,this.destination.next(e))}}var E=i("Cfvw");class T{constructor(e){this.predicate=e}call(e,t){return t.subscribe(new z(e,this.predicate))}}class z extends x.a{constructor(e,t){super(e),this.predicate=t,this.skipping=!0,this.index=0}_next(e){const t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)}tryCallPredicate(e){try{const t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(t){this.destination.error(t)}}}var G=i("pLZG");const A=["youtubeContainer"];let Q=(()=>{class e{constructor(e,t){this._ngZone=e,this._youtubeContainer=new c.a,this._destroyed=new c.a,this._playerChanges=new h.a(void 0),this._videoId=new h.a(void 0),this._height=new h.a(390),this._width=new h.a(640),this._startSeconds=new h.a(void 0),this._endSeconds=new h.a(void 0),this._suggestedQuality=new h.a(void 0),this._playerVars=new h.a(void 0),this.ready=this._getLazyEmitter("onReady"),this.stateChange=this._getLazyEmitter("onStateChange"),this.error=this._getLazyEmitter("onError"),this.apiChange=this._getLazyEmitter("onApiChange"),this.playbackQualityChange=this._getLazyEmitter("onPlaybackQualityChange"),this.playbackRateChange=this._getLazyEmitter("onPlaybackRateChange"),this._isBrowser=Object(a.o)(t)}get videoId(){return this._videoId.value}set videoId(e){this._videoId.next(e)}get height(){return this._height.value}set height(e){this._height.next(e||390)}get width(){return this._width.value}set width(e){this._width.next(e||640)}set startSeconds(e){this._startSeconds.next(e)}set endSeconds(e){this._endSeconds.next(e)}set suggestedQuality(e){this._suggestedQuality.next(e)}get playerVars(){return this._playerVars.value}set playerVars(e){this._playerVars.next(e)}ngOnInit(){if(!this._isBrowser)return;let e=Object(d.a)(!0);if(!window.YT||!window.YT.Player){const t=new c.a;this._existingApiReadyCallback=window.onYouTubeIframeAPIReady,window.onYouTubeIframeAPIReady=()=>{this._existingApiReadyCallback&&this._existingApiReadyCallback(),this._ngZone.run(()=>t.next(!0))},e=t.pipe(Object(v.a)(1),Object(f.a)(!1))}const t=function(e,t,i,a,s,n,r){const o=Object(g.b)([t,n]).pipe(V(Object(g.b)([a,s])),Object(u.a)(([e,t])=>{const[i,a]=e,[s,n]=t;return i?{videoId:i,playerVars:a,width:s,height:n}:void 0}));return Object(g.b)([e,o,Object(d.a)(r)]).pipe((c=i,Object(_.a)(function(...e){let t=null;return"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Object(p.a)(e[0])&&(e=e[0].slice()),i=>i.lift.call(Object(E.a)([i,...e]),new g.a(t))}(c),(h=([e,t])=>!t,e=>e.lift(new T(h))),Object(u.a)(([e])=>e))),Object(R.a)(F,void 0),e=>e.lift(new L(void 0,void 0)));var c,h}(this._youtubeContainer,this._videoId,e,this._width,this._height,this._playerVars,this._ngZone).pipe(Object(w.a)(e=>{this._playerChanges.next(e)}),(i=e=>{H(e)||e.destroy()},Object(C.a)(e=>e?H(e)?Object(d.a)(e):new l.a(t=>{let a=!1,s=!1;const n=e=>{s=!0,a||(e.target.removeEventListener("onReady",n),t.next(e.target))};return e.addEventListener("onReady",n),()=>{a=!0,s||i(e)}}).pipe(Object(v.a)(1),Object(f.a)(void 0)):Object(d.a)(void 0))),Object(k.a)(this._destroyed),Object(S.a)(new c.a));var i;t.subscribe(e=>{this._player=e,e&&this._pendingPlayerState&&this._initializePlayer(e,this._pendingPlayerState),this._pendingPlayerState=void 0}),function(e,t,i){Object(g.b)([e,t,i]).subscribe(([e,t,i])=>e&&e.setSize(t,i))}(t,this._width,this._height),function(e,t){Object(g.b)([e,t]).subscribe(([e,t])=>e&&t&&e.setPlaybackQuality(t))}(t,this._suggestedQuality),function(e,t,i,a,s,n){const r=Object(g.b)([i,a]).pipe(Object(u.a)(([e,t])=>({startSeconds:e,endSeconds:t}))),o=r.pipe(U(e,e=>!!e&&!function(e){const t=e.getPlayerState();return-1!==t&&5!==t}(e))),c=t.pipe(U(e,(e,t)=>!!e&&e.videoId!==t)),h=e.pipe(U(Object(g.b)([t,r]),([e,t],i)=>!(!i||e==i.videoId&&!t.startSeconds&&!t.endSeconds)));Object(m.a)(h,c,o).pipe(V(Object(g.b)([e,t,r,s])),Object(u.a)(([e,t])=>t),Object(k.a)(n)).subscribe(([e,t,i,a])=>{t&&e&&(e.videoId=t,e.cueVideoById(Object.assign({videoId:t,suggestedQuality:a},i)))})}(t,this._videoId,this._startSeconds,this._endSeconds,this._suggestedQuality,this._destroyed),t.connect()}createEventsBoundInZone(){return{}}ngAfterViewInit(){this._youtubeContainer.next(this.youtubeContainer.nativeElement)}ngOnDestroy(){this._player&&(this._player.destroy(),window.onYouTubeIframeAPIReady=this._existingApiReadyCallback),this._playerChanges.complete(),this._videoId.complete(),this._height.complete(),this._width.complete(),this._startSeconds.complete(),this._endSeconds.complete(),this._suggestedQuality.complete(),this._youtubeContainer.complete(),this._playerVars.complete(),this._destroyed.next(),this._destroyed.complete()}playVideo(){this._player?this._player.playVideo():this._getPendingState().playbackState=1}pauseVideo(){this._player?this._player.pauseVideo():this._getPendingState().playbackState=2}stopVideo(){this._player?this._player.stopVideo():this._getPendingState().playbackState=5}seekTo(e,t){this._player?this._player.seekTo(e,t):this._getPendingState().seek={seconds:e,allowSeekAhead:t}}mute(){this._player?this._player.mute():this._getPendingState().muted=!0}unMute(){this._player?this._player.unMute():this._getPendingState().muted=!1}isMuted(){return this._player?this._player.isMuted():!!this._pendingPlayerState&&!!this._pendingPlayerState.muted}setVolume(e){this._player?this._player.setVolume(e):this._getPendingState().volume=e}getVolume(){return this._player?this._player.getVolume():this._pendingPlayerState&&null!=this._pendingPlayerState.volume?this._pendingPlayerState.volume:0}setPlaybackRate(e){if(this._player)return this._player.setPlaybackRate(e);this._getPendingState().playbackRate=e}getPlaybackRate(){return this._player?this._player.getPlaybackRate():this._pendingPlayerState&&null!=this._pendingPlayerState.playbackRate?this._pendingPlayerState.playbackRate:0}getAvailablePlaybackRates(){return this._player?this._player.getAvailablePlaybackRates():[]}getVideoLoadedFraction(){return this._player?this._player.getVideoLoadedFraction():0}getPlayerState(){if(this._isBrowser&&window.YT)return this._player?this._player.getPlayerState():this._pendingPlayerState&&null!=this._pendingPlayerState.playbackState?this._pendingPlayerState.playbackState:-1}getCurrentTime(){return this._player?this._player.getCurrentTime():this._pendingPlayerState&&this._pendingPlayerState.seek?this._pendingPlayerState.seek.seconds:0}getPlaybackQuality(){return this._player?this._player.getPlaybackQuality():"default"}getAvailableQualityLevels(){return this._player?this._player.getAvailableQualityLevels():[]}getDuration(){return this._player?this._player.getDuration():0}getVideoUrl(){return this._player?this._player.getVideoUrl():""}getVideoEmbedCode(){return this._player?this._player.getVideoEmbedCode():""}_getPendingState(){return this._pendingPlayerState||(this._pendingPlayerState={}),this._pendingPlayerState}_initializePlayer(e,t){const{playbackState:i,playbackRate:a,volume:s,muted:n,seek:r}=t;switch(i){case 1:e.playVideo();break;case 2:e.pauseVideo();break;case 5:e.stopVideo()}null!=a&&e.setPlaybackRate(a),null!=s&&e.setVolume(s),null!=n&&(n?e.mute():e.unMute()),null!=r&&e.seekTo(r.seconds,r.allowSeekAhead)}_getLazyEmitter(e){return this._playerChanges.pipe(Object(P.a)(t=>t?b(i=>{t.addEventListener(e,i)},i=>{try{t.removeEventListener&&t.removeEventListener(e,i)}catch(a){}}):Object(d.a)()),e=>new l.a(t=>e.subscribe({next:e=>this._ngZone.run(()=>t.next(e)),error:e=>t.error(e),complete:()=>t.complete()})),Object(k.a)(this._destroyed))}}return e.\u0275fac=function(t){return new(t||e)(o.Jb(o.z),o.Jb(o.B))},e.\u0275cmp=o.Db({type:e,selectors:[["youtube-player"]],viewQuery:function(e,t){if(1&e&&o.kc(A,!0),2&e){let e;o.cc(e=o.Ub())&&(t.youtubeContainer=e.first)}},inputs:{videoId:"videoId",height:"height",width:"width",startSeconds:"startSeconds",endSeconds:"endSeconds",suggestedQuality:"suggestedQuality",playerVars:"playerVars",showBeforeIframeApiLoads:"showBeforeIframeApiLoads"},outputs:{ready:"ready",stateChange:"stateChange",error:"error",apiChange:"apiChange",playbackQualityChange:"playbackQualityChange",playbackRateChange:"playbackRateChange"},decls:2,vars:0,consts:[["youtubeContainer",""]],template:function(e,t){1&e&&o.Kb(0,"div",null,0)},encapsulation:2,changeDetection:0}),e})();function F(e,[t,i,a]){if(e&&i&&e.playerVars!==i.playerVars)e.destroy();else{if(!i)return void(e&&e.destroy());if(e)return e}const s=a.runOutsideAngular(()=>new YT.Player(t,i));return s.videoId=i.videoId,s.playerVars=i.playerVars,s}function H(e){return"getPlayerStatus"in e}function U(e,t){return Object(_.a)(V(e),Object(G.a)(([e,i])=>t(i,e)),Object(u.a)(([e])=>e))}let B=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)}}),e})();var Z=i("Xa2L");const K=["video"],Y=["canvas"],J=["youtube"];function N(e,t){1&e&&o.Kb(0,"mat-spinner")}function X(e,t){1&e&&(o.Mb(0,"h1"),o.ic(1,"Hai perso, hai sorriso!"),o.Lb())}function q(e,t){1&e&&(o.Mb(0,"h1"),o.ic(1,"Hai vinto, non hai sorriso!"),o.Lb())}function W(e,t){1&e&&(o.Mb(0,"h1"),o.ic(1,"Non riesco a vedere la tua faccia!"),o.Lb())}let $=!1;const ee=[{path:"",component:(()=>{class e{constructor(e){this.cdr=e,this.faceMissingDetection=0,this.faceDetected=!1,this.faceHappy=!1,this.loseMatch=!1,this.winMatch=!1,this.happy=0,this.readyToGame=!1,this.playerVars={autoplay:0,controls:0,showinfo:0,modestbranding:1,rel:0},this.loading=!1,this.firstDetectionHappen=!1}ngOnInit(){if(!$){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e),$=!0}}ngOnDestroy(){this.stream&&this.stream.getTracks().forEach(e=>e.stop())}ngAfterViewInit(){}onStateChange(e){0===e.data&&this.winGame()}onReady(e){this.run()}run(){return Object(n.a)(this,void 0,void 0,function*(){this.loading=!0,this.cdr.detectChanges();const e="/assets/weights/";yield Promise.all([r.e.tinyFaceDetector.loadFromUri(e),r.e.faceRecognitionNet.loadFromUri(e),r.e.faceExpressionNet.loadFromUri(e)]),this.stream=yield navigator.mediaDevices.getUserMedia({video:{}}),this.video.nativeElement.srcObject=this.stream,this.loading=!1,this.cdr.detectChanges()})}onPlay(){return Object(n.a)(this,void 0,void 0,function*(){const e=this.video.nativeElement;if(this.manageDetectionState(),e.paused||e.ended||!r.e.tinyFaceDetector.params)return this.faceMissingDetection=50,void setTimeout(()=>this.onPlay(),100);const t=yield r.b(e,new r.a).withFaceExpressions();if(t){this.firstDetectionHappen=!0,this.faceMissingDetection=0;const e=t.expressions.happy;if(this.happy!==e&&(this.happy=e,this.cdr.markForCheck()),this.happy>.8)return void this.loseGame()}else this.happy=0,this.firstDetectionHappen&&this.faceMissingDetection++;setTimeout(()=>this.onPlay(),100)})}manageDetectionState(){let e=this.faceMissingDetection<50;this.firstDetectionHappen||(e=!1),this.faceDetected!==e&&(this.faceDetected=e,this.faceDetected?this.youtube.playVideo():this.youtube.pauseVideo(),this.manageReadyToGameState(),this.cdr.markForCheck())}loseGame(){this.loseMatch||(this.winMatch=!1,this.loseMatch=!0,this.video.nativeElement.pause(),this.youtube.pauseVideo(),this.manageReadyToGameState(),this.cdr.markForCheck())}winGame(){this.winMatch||(this.winMatch=!0,this.loseMatch=!1,this.video.nativeElement.pause(),this.youtube.stopVideo(),this.manageReadyToGameState(),this.cdr.markForCheck())}manageReadyToGameState(){const e=!this.loseMatch&&this.faceDetected;this.readyToGame!==e&&(this.readyToGame=e,this.cdr.markForCheck())}}return e.\u0275fac=function(t){return new(t||e)(o.Jb(o.h))},e.\u0275cmp=o.Db({type:e,selectors:[["app-arcade"]],viewQuery:function(e,t){if(1&e&&(o.kc(K,!0),o.kc(Y,!0),o.kc(J,!0)),2&e){let e;o.cc(e=o.Ub())&&(t.video=e.first),o.cc(e=o.Ub())&&(t.canvas=e.first),o.cc(e=o.Ub())&&(t.youtube=e.first)}},decls:15,vars:11,consts:[[4,"ngIf"],[3,"hidden"],["videoId","FFLTU9eIijw",3,"playerVars","ready","stateChange"],["youtube",""],[1,"video-container",3,"hidden"],["autoplay","","muted","","playsinline","",3,"loadedmetadata"],["video",""]],template:function(e,t){1&e&&(o.hc(0,N,1,0,"mat-spinner",0),o.Mb(1,"div",1),o.hc(2,X,2,0,"h1",0),o.hc(3,q,2,0,"h1",0),o.Mb(4,"ul"),o.Mb(5,"li"),o.ic(6),o.Xb(7,"number"),o.Lb(),o.Lb(),o.Mb(8,"div",1),o.Mb(9,"youtube-player",2,3),o.Tb("ready",function(e){return t.onReady(e)})("stateChange",function(e){return t.onStateChange(e)}),o.Lb(),o.Lb(),o.Mb(11,"div",4),o.Mb(12,"video",5,6),o.Tb("loadedmetadata",function(){return t.onPlay()}),o.Lb(),o.hc(14,W,2,0,"h1",0),o.Lb(),o.Lb()),2&e&&(o.bc("ngIf",t.loading),o.zb(1),o.bc("hidden",t.loading),o.zb(1),o.bc("ngIf",t.loseMatch),o.zb(1),o.bc("ngIf",t.winMatch),o.zb(3),o.jc("Felicit\xe0: ",o.Yb(7,9,100*t.happy),"%"),o.zb(2),o.bc("hidden",!t.readyToGame),o.zb(1),o.bc("playerVars",t.playerVars),o.zb(2),o.bc("hidden",t.readyToGame),o.zb(3),o.bc("ngIf",!t.faceDetected))},directives:[a.i,Q,Z.c],pipes:[a.d],styles:[".video-container[_ngcontent-%COMP%]{position:relative}.video-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%], .video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]}),e})()}];let te=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)},imports:[[s.b.forChild(ee)],s.b]}),e})(),ie=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)},imports:[[a.b,te,Z.b,B]]}),e})()}}]);